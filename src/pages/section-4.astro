---
import BaseLayout from '../layouts/BaseLayout.astro';
import Navigation from '../components/Navigation.astro';
import Hero from '../components/Hero.astro';

// Images will be loaded client-side from S3 via API
---

<BaseLayout title="Foto's - Doeltreffend">
  <Navigation />
  
  <!-- Hero Section -->
  <Hero 
    title="Photos"
    subtitle="Photos"
    height="large"
  />
  
  <!-- Content Section -->
  <section class="py-24 px-6 max-w-7xl mx-auto">
    <div class="mb-16" data-aos="fade-up">
      <h2 class="text-3xl md:text-4xl font-bold mb-4" data-i18n="sections.overview">Section Overview</h2>
      <p class="text-white/70 text-lg max-w-3xl" data-i18n="sections.section4Description">
        Welcome to Section 4 of our architecture portfolio. This section contains fundamental concepts and initial design explorations.
      </p>
    </div>
    
    <!-- Loading state -->
    <div id="loading" class="text-center py-20">
      <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-amber-400"></div>
      <p class="mt-4 text-white/70" data-i18n="sections.loading">Loading images...</p>
    </div>

    <!-- Images container (populated by JavaScript) -->
    <div id="images-grid" class="hidden grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"></div>

    <!-- No content placeholder -->
    <div id="no-content" class="hidden text-center py-20" data-aos="fade-up">
      <div class="mb-8">
        <svg class="w-24 h-24 mx-auto text-white/20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
        </svg>
      </div>
      <h3 class="text-2xl font-bold mb-4" data-i18n="sections.noContent">No Content Yet</h3>
      <p class="text-white/60 max-w-md mx-auto" data-i18n="sections.noContentDescription">
        Images will appear here once uploaded to S3.
      </p>
    </div>

    <!-- Error state -->
    <div id="error" class="hidden text-center py-20 text-red-400">
      <p data-i18n="sections.errorLoading">Failed to load images. Please try again later.</p>
    </div>
  </section>

  <script>
    import { getPreferredLanguage, t } from '../i18n/utils';
    
    // Update translations
    function updateTranslations() {
      const currentLang = getPreferredLanguage();
      
      // Update text content
      document.querySelectorAll('[data-i18n]').forEach((el) => {
        const key = (el as HTMLElement).dataset.i18n;
        if (key) {
          el.textContent = t(key, currentLang);
        }
      });
      
      // Update Hero title and subtitle
      const heroTitle = document.querySelector('.hero-section h1');
      const heroSubtitle = document.querySelector('.hero-section p');
      if (heroTitle) heroTitle.textContent = t('sections.section4Title', currentLang);
      if (heroSubtitle) heroSubtitle.textContent = t('sections.section4Subtitle', currentLang);
      
      // Update dynamically created "View Full Size" links if they exist
      document.querySelectorAll('.view-full-size').forEach((el) => {
        el.textContent = t('sections.viewFullSize', currentLang);
      });
    }
    
    // Fetch images from API
    async function loadImages() {
      try {
        const response = await fetch('/api/images/4');
        const data = await response.json();
        
        const loading = document.getElementById('loading');
        const grid = document.getElementById('images-grid');
        const noContent = document.getElementById('no-content');
        const error = document.getElementById('error');
        
        if (!response.ok) {
          throw new Error('Failed to fetch images');
        }
        
        if (loading) loading.classList.add('hidden');
        
        if (data.files && data.files.length > 0) {
          if (grid) {
            grid.classList.remove('hidden');
            const currentLang = getPreferredLanguage();
            const viewFullSizeText = t('sections.viewFullSize', currentLang);
            
            data.files.forEach((file: any, index: number) => {
              const card = document.createElement('div');
              card.className = 'bg-slate-800/50 backdrop-blur-sm border border-white/10 rounded-xl p-6 hover:border-amber-400/50 transition-all duration-300';
              card.setAttribute('data-aos', 'fade-up');
              card.setAttribute('data-aos-delay', (index * 100).toString());
              
              card.innerHTML = `
                <div class="flex items-center justify-center h-48 bg-slate-700/50 rounded-lg mb-4 overflow-hidden">
                  <img 
                    src="${file.url}" 
                    alt="${file.filename}"
                    class="w-full h-full object-cover rounded-lg"
                    loading="lazy"
                  />
                </div>
                <h3 class="font-semibold text-white mb-2 truncate">${file.filename}</h3>
                <a 
                  href="${file.url}"
                  target="_blank"
                  class="text-amber-400 text-sm hover:text-amber-300 transition-colors view-full-size"
                >
                  ${viewFullSizeText}
                </a>
              `;
              
              grid.appendChild(card);
            });
          }
        } else {
          if (noContent) noContent.classList.remove('hidden');
        }
      } catch (err) {
        console.error('Error loading images:', err);
        const loading = document.getElementById('loading');
        const error = document.getElementById('error');
        if (loading) loading.classList.add('hidden');
        if (error) error.classList.remove('hidden');
      }
    }
    
    // Initialize translations
    updateTranslations();
    
    // Listen for language changes
    window.addEventListener('languagechange', updateTranslations);
    
    // Load images when page loads
    loadImages();
  </script>
  
  <!-- Navigation to other sections -->
  <section class="py-12 px-6 border-t border-white/10">
    <div class="max-w-7xl mx-auto flex justify-between items-center">
      <a href="/section-3" class="text-white/70 hover:text-amber-400 transition-colors">
        ← <span data-i18n="nav.section3">Photo Map</span>
      </a>
      <a href="/" class="text-white/70 hover:text-amber-400 transition-colors" data-i18n="sections.backToHome">
        Back to Home →
      </a>
    </div>
  </section>
</BaseLayout>
